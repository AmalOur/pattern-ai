<div class="flex h-screen overflow-hidden">
  <!-- Sidebar with Logo -->
  <div class="w-64 bg-gray-800 text-white flex flex-col min-h-screen">
    <!-- Logo Section -->
    <div class="p-4 border-b border-gray-700">
      <div class="flex items-center justify-center">
        <img src="assets/logo_b.png" alt="Pattern AI" class="p-2 w-40 h-20"/>
      </div>
    </div>

    <!-- Spaces Section -->
    <div class="p-4 flex-1 overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold"></h2>
        <button
          (click)="createNewSpace()"
          class="p-1 rounded-full hover:bg-gray-700 focus:outline-none"
          title="Create New Space"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
        </button>
      </div>
      
      <!-- Group spaces by date -->
      <div class="space-y-4">
        <ng-container *ngFor="let group of groupedSpaces | keyvalue">
          <!-- Date header -->
          <div class="text-sm text-gray-400 font-medium pl-2">
            {{ group.key }}
          </div>
          
          <!-- Spaces for this date -->
          <div class="space-y-1">
            <div
              *ngFor="let space of group.value"
              [class.bg-blue-600]="currentSpace?.id === space.id"
              class="p-2 rounded cursor-pointer flex items-center justify-between"
              [class.hover:bg-gray-700]="currentSpace?.id !== space.id"
              (click)="onSpaceSelected(space)"
            >
              <span class="truncate">{{ space.name }}</span>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- Main Chat Area -->
  <div class="flex-1 flex flex-col overflow-hidden">
    <!-- Header -->
    <app-header 
      [currentSpace]="currentSpace || undefined"
      [processedCode]="processedCode"
      (deleteSpaceEvent)="deleteSpace()"
      (deleteProcessedCodeEvent)="deleteProcessedCode($event)"
      class="border-b shadow-sm"
    />

    <!-- Chat Content Area -->
    <div class="flex-1 flex flex-col bg-gray-50 overflow-hidden">
      <!-- Error Message -->
      <div *ngIf="errorMessage" class="bg-red-50 text-red-700 p-4 text-sm">
        {{ errorMessage }}
        <button (click)="errorMessage = ''" class="float-right">&times;</button>
      </div>

      <!-- Messages Container -->
      <div #messagesContainer class="flex-1 overflow-y-auto p-4 space-y-4">
        <app-message
          *ngFor="let msg of messages"
          [message]="msg"
        ></app-message>

        <!-- Scroll to Bottom Button -->
        <button
          *ngIf="!isAtBottom"
          (click)="scrollToBottom()"
          class="fixed bottom-24 right-8 bg-blue-600 text-white rounded-full p-3 shadow-lg hover:bg-blue-700 hover:shadow-xl transition-all z-10"
          title="Scroll to Bottom"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>

      <!-- Input Area -->
      <div class="p-4 bg-white border-t">
        <div class="flex space-x-4">
          <input
            type="text"
            [(ngModel)]="message"
            (keyup.enter)="sendMessage()"
            [disabled]="!currentSpace || isLoading"
            placeholder="Type your message..."
            class="flex-1 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <button
            (click)="sendMessage()"
            [disabled]="!currentSpace || !message.trim() || isLoading"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center"
          >
            Send
          </button>
          <button
            (click)="openRepoDialog()"
            [disabled]="!currentSpace || isLoading"
            class="p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
            title="Analyze Repository"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Dialogs -->
  <app-space-dialog
    *ngIf="showSpaceDialog"
    (submitted)="handleSpaceCreation($event)"
    (closed)="showSpaceDialog = false"
  />

  <app-repo-dialog
    *ngIf="showRepoDialog && !isAnalyzing"
    (submitted)="analyzeRepo($event)"
    (closed)="showRepoDialog = false"
  />
  <div *ngIf="isAnalyzing" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-gray-800 p-6 rounded-lg shadow-xl">
      <div class="flex flex-col items-center">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
        <p class="mt-4 text-white">Analyzing repository...</p>
      </div>
    </div>
  </div>
</div>